name: üöÄ Auto Deploy to cPanel

on:
  push:
    branches:
      - main

jobs:
  deploy:
    name: Push ‚Üí cPanel ‚Üí Live
    runs-on: ubuntu-latest

    steps:
      - name: ‚¨áÔ∏è Checkout code
        uses: actions/checkout@v4

      - name: üîÑ Pull latest code on cPanel
        run: |
          echo "Step 1: Triggering cPanel git pull..."
          PULL=$(curl -s -w "\n%{http_code}" \
            -H "Authorization: cpanel ${{ secrets.CPANEL_USER }}:${{ secrets.CPANEL_TOKEN }}" \
            "https://harmaalwale.com:2083/execute/VersionControl/update?repository_root=/home1/harmakko/repositories/harmaalwale.com")
          PULL_STATUS=$(echo "$PULL" | tail -1)
          PULL_BODY=$(echo "$PULL" | head -1)
          echo "Pull HTTP Status: $PULL_STATUS"
          echo "Pull Response: $PULL_BODY"

      - name: üöÄ Run cPanel deployment (.cpanel.yml)
        run: |
          echo "Step 2: Triggering cPanel deploy tasks..."
          DEPLOY=$(curl -s -w "\n%{http_code}" \
            -H "Authorization: cpanel ${{ secrets.CPANEL_USER }}:${{ secrets.CPANEL_TOKEN }}" \
            "https://harmaalwale.com:2083/execute/VersionControlDeployment/create?repository_root=/home1/harmakko/repositories/harmaalwale.com")
          DEPLOY_STATUS=$(echo "$DEPLOY" | tail -1)
          DEPLOY_BODY=$(echo "$DEPLOY" | head -1)
          echo "Deploy HTTP Status: $DEPLOY_STATUS"
          echo "Deploy Response: $DEPLOY_BODY"

      - name: ‚úÖ Done
        run: |
          echo "=========================================="
          echo " harmaalwale.com should be live now!"
          echo "=========================================="
